## The Many Steps of Name Resolution

At its most basic, DNS is a system that converts domain names into IP addresses. It's the way humans are likely to remember and categorize things resolved into the way computers prefer to think of things. This process of using DNS to turn a domain name into an IP address is known as name resolution. Let's take a closer look at exactly how this works. The first thing that's important to know is that DNS servers, are one of the things that need to be specifically configured at a node on a network. For a computer to operate on a modern network, they need to have certain number of things configured. Remember, that MAC addresses are hard coded and tied to specific pieces of hardware. But we've also covered that the IP address, subnet mask, and gateway for a host must be specifically configured, a DNS server, is the fourth and final part of the standard modern network configuration. These are almost always the four things that must be configured for a host to operate on a network in an expected way. I should call out, that a computer can operate just fine without DNS or without a DNS server being configured, but as we covered in the last video, this makes things difficult for any human that might be using that computer. There are five primary types of DNS servers; caching name servers, recursive name servers, root name servers, TLD name servers, and authoritative name servers. As we dive deeper into these, it's important to note that any given DNS server can fulfill many of these roles at once. Caching and recursive name servers are generally provided by an ISP or your local network. Their purpose is to store domain name lookups for a certain amount of time. As you'll see in a moment, there are lots of steps in order to perform a fully qualified resolution of a domain name. In order to prevent this from happening every single time a new TCP connection is established, your ISP or local network will generally have a caching name server available. Most caching name servers are also recursive name servers. Recursive name servers are ones that perform full DNS resolution requests. In most cases, your local name server will perform the duties of both, but it's definitely possible for a name server to be either just caching or just recursive. Let's introduce an example to better explain how this works. You and your friend are both connected to the same network and you both want to check out Facebook.com, your friend enters www.facebook.com into a web browser, which means that their computer now needs to know the IP of www.facebook.com in order to establish a connection. Both of your computers are on the same network which usually means, that they both been configured with the same name server. So your friends computer ask the name server for the IP of www.facebook.com which it doesn't know, this name server now performs a fully recursive resolution to discover the correct IP for www.facebook.com. This involves a bunch of steps we'll cover in just a moment. This IP is then both delivered to your friend's computer and stored locally in a cache. A few minutes later you enter www.facebook.com into a web browser. Again, your computer needs to know the IP for this domain, so your computer asks the local name server it's been configured with, which is the same one your friend's computer was just talking to. Since the domain name www.Facebook.com had just been looked up, the local name server still has the IP that it resolved to stored and is able to deliver that back to your computer without having to perform a full lookup. This is how the same servers act as a caching server. All domain names in the global DNS system have a TTL or time to live. This is a value in seconds, that can be configured by the owner of a domain name for how long a name server is allowed to cache in entry before it should discard it and perform a full resolution again. Several years ago, it was normal for these TTL's to be really long, sometimes a full day or more. This is because the general bandwidth available on the Internet was just much less, so network administrators didn't want to waste what bandwidth was available to them by constantly performing full DNS lookups. As the Internet has grown and gone faster, these TTL's for most domains have dropped to anywhere from a few minutes to a few hours. But it's important to know that sometimes you still run into a domain names with very lengthy TTL's, it means that it can take up to the length of a total TTL for a change in DNS record to be known to the entire Internet. Now, let's look at what happens when your local recursive server needs to perform a full recursive resolution. The first step is always to contact a root named server, there are 13 total root name servers and they're responsible for directing queries toward the appropriate TLD name server. In the past, these 13 root servers were distributed to very specific geographic regions, but today, they're mostly distributed across the globe via anycast. Anycast is a technique that's used to route traffic to different destinations depending on factors like location, congestion, or link health. Using anycast, a computer can send a data gram to a specific IP but could see it routed to one of many different actual destinations depending on a few factors. This should also make it clear that there aren't really only 13 physical route name servers anymore. It's better to think of them as 13 authorities that provide route name lookups as a service. The root servers will respond to a DNS lookup with the TLD name server that should be queried. TLD stands for top level domain and represents the top of the hierarchical DNS name resolution system. A TLD is the last part of any domain name, using www.facebook.com as an example again, the dot com portion should be thought of as the TLD. We'll go into more details about the different components of a domain name in an upcoming lesson. For each TLD in existence, there is a TLD name server, but just like with root servers, this doesn't mean there's only physically one server in question, it's most likely a global distribution of any cast accessible servers responsible for each TLD. The TLD name servers will respond again with a redirect, this time informing the computer performing the name lookup with what authoritative name server to contact. Authoritative name servers are responsible for the last two parts of any domain name which is the resolution at which a single organization may be responsible for DNS lookups. Using www.weather.com as an example, the TLD name server would point a lookup at the authoritative server for Weather.com, which would likely be controlled by the Weather Channel, the organization itself that runs the site. Finally, the DNS lookup could be redirected at the authoritative server for weather.com which would finally provide the actual IP of the server in question. This strict hierarchy is very important to the stability of the internet, making sure that all full DNS resolutions go through a strictly regulated and controlled series of lookups to get the correct responses, is the best way to protect against malicious parties redirecting traffic. Your computer will blindly send traffic to whatever IP it's told to. So by using a hierarchical system controlled by trusted entities in the way DNS does, we can better ensure that the responses to DNS lookups are accurate. Now that you see how many steps are involved, it should make sense why we trust our local name servers to cache DNS lookups, its so that full lookup path doesn't have to happen for every single TCP connection. In fact, your local computer from your phone to a desktop will generally have its own temporary DNS cache as well, that way, it doesn't have to bother its local name server for every TCP connection either.





最基本的是，DNS 是一个将域名转换为 IP 地址的系统。 这就是人类可能记住并 将解决的事物分类为计算机喜欢思考事物的方式。 使用 DNS 将 域名转换为 IP 地址的过程称为域名解析。 让我们仔细看看这是如何工作的。 需 要知道的第 一件事是 DNS 服务器是需要在网络上的节点上专门配置的事情之一。 要使计算机在现代网络上运行， 他们需要配置一定数量的内容。 请记住，MAC 地址是硬编码的，并绑定到特定的硬件。 但是，我们还介绍了 主机的 IP 地址、子网掩码和网关必须经过专门配置，即 DNS 服务器，是标准现代网络配置的第四部分，也是最后一部分。 这些几乎总是必须 配置的四件事情，以便主机以预期的方式在网络上运行。 我应该大声疾呼，没有 DNS 或没有配置 DNS 服务器的计算机可以正常运行， 但正如我们在最后一段视频中所述， 这使得任何可能使用该计算机的人都很困难。 DNS 服务器有五种主要类型：缓存名称服务器、 递归名称服务器、根名称服务器、 TLD 名称服务器和权威名称服务器。 当我们深入研究这些问 题时，请注意，任何给定的 DNS 服务器都可以同时履行其中的许多角色。 缓存和递归名称服务器 通常由 ISP 或您的本地网络提供。 它们的目的是将域名查找存储一定的时间。 正 如您稍后会看到的 那样，有很多步骤来执行 域名的完全限定解析。 为了防止每次 建立新的 TCP 连接时都发生这种情况， 您的 ISP 或本地网络通常会有一个可用的缓存名称服务器。 大多数缓存名称服务器也是递归名称服务器。 递归名称服务器是执行完整 DNS 解析请求的服务器。 在大多数情况下，您的本地名称服务器将执行两者 的职责，但是名称服务器绝对有可能 只是缓存或递归。 让我们来介绍一个例子来更好地解释这是如何工作的。 你和你的朋友都连接到同一个网络， 你们都希望查看 FaceBook.com， 你的朋友将 www.Facebook.com 进入一个网络浏览器， 这意味着他们的电脑现在需要知道 www.Facebook.com 的 IP 才能建立连接。 您的两台计算机都在同一个网络上，这通常意味着, 它们都配置了相同的名称服务器. 所以你的朋友电脑要求名称服务器获取 它不知道的 www.Facebook.com 的 IP， 这个名称服务器现在会执行一个完全递归的 解析来发现 www.Facebook.com 的正确 IP。 这涉及到一堆步骤，我们将在短短的时间内讨论。 然后，此 IP 将传送到朋友的计算机并存储在本地缓存中。 几分钟后，您将 www.Facebook.com 进入网页浏览器。 同 样，您的计算机需要知道此域的 IP， 因此您的计算机会询问已配置的本地名称服务器，该服务器与 您朋友的计算机刚才通话的服务器相同。 由于域名 www.FaceBook.com 已被查找， 本地名称服务器仍然具有它解析为存储的 IP，并 且能够将其传送回您的计算机，而无需执行完整查找。 这就是相同的服务器作为缓存服务器的方式。 全局 DNS 系统中的所有域名都有 TTL 或生存时间。 这是一个以秒 为单位的值，域名所有者可以配置域名服务器 允许在条目中缓存多长 时间，然后再次执行完整解析。 几年前，这些 TTL 很长， 有时一整天或更长时间是正常的。 这是因为 Internet 上可用的一般带宽要少得多，因 此网络管理员不希望 通过不断执行完整的 DNS 查找来浪费可用的带宽。 随着互联网的发展和走 得更快，大多数域的这些 TTL 已经从几分钟到几个小时的时间下降到任何地方。 但重要的是要知道，有时你仍然 遇到一个域名与非常冗长的 TTL, 这意味着它可能需要一个总 TTL 的长度， 在 DNS 记录的变化是已知的整个互联网. 现在，让我们看看当 您的本地递归服务器需要执行完整递归解析时会发生什么。 第一步始终是联系根命名的服务器， 总共有 13 个根名称服务器，他们 负责将查询定向到适当的 TLD 名称服务器。 过去，这 13 台根服务器分布到非常特定的地理区域， 但如今，它们大多通过 anycast 分布在全球各地。 Anycast 是一种技术，用于 根据位置、 拥塞或链路运行状况等因素将流量路由到不同的目的地。 使用 anycast，计算机可以将数据包发送到特定 IP，但可以 看到它路由到许多不同的实际目的地之一，具体取决于几个因素。 这也应该清楚地表明，不再 只有 13 个物理路由名称服务器了。 最好将它们视为 提供路由名称查找作为服务的 13 个机构。 根服务器将使 用应查询的 TLD 名称服务器响应 DNS 查找。 TLD 代表顶级域， 代表分层 DNS 名称解析系统的顶部。 顶级域名是任何域名的最后一部分， 使用 www.Facebook.com 再次作为例子， 点 COM 部分应被视为顶级域名。 我们将在接下 来的课程中详细介绍域名的不同组成部分。 对于现有的每个 TLD，都 有一个 TLD 名称服务器， 但就像根服务器一样， 这并不意味着物理上只有一个服务器， 它很可能是 负责每个 TLD 的任何转换可访问服务器的全球分布。 TLD 名称服务器将再次响应重定向， 这次通知执行 名称查找的计算机与哪个权威名称服务器联系。 权威域名服务器负责 任何域名的最后两部分，即 单个组织可能负责 DNS 查找的解决方案。 以 www.weather.com 为例， TLD 名称服务器将指向 Weather.com 的权威服务器查找， 该服务器很可能由天气频道控制，而天气频道是 运行该站点的组织本身。 最后，DNS 查找可以重定向到 weather.com 的权威服务器，这将最终提供相关服务器的实际 IP。 这种严格的层次结构对于互联网的稳定性非常重要，确保所有完整的 DNS 解决方案都经过严格监管和控制的一系列查找以获得正确响应，是防止恶意方重定向流量的最佳方式。 您的计算机会盲目地将流量发送到其告知的任何 IP。 因此，通过使用由受信任实体控制的分层系统，通过 DNS 的方式， 我们可以更好地确保对 DNS 查找的响应是准确的。 现在，您已经看到了涉及到多少步骤， 那么为什么我们信任我们的本地名称服务器 来缓存 DNS 查找，这样就不必为每个 TCP 连接发生完整的查找路径。 事实上，从手机到 桌面的本地计算机通常也会有自己的临时 DNS 缓存， 这样，它就不必为 每个 TCP 连接打扰其本地名称服务器。