## Basics of NAT

Welcome back, ready to dive right in? So unlike protocols like DNS and DHCP, network address translation or NAT, is a technique instead of a defined standard. This means that some of what we'll discuss in this lesson might be more high level than some of our other topics. Different operating systems and different network hardware vendors have implemented the details of NAT in different ways, but the concepts of what it accomplishes are pretty constant. Network address translation does pretty much what it sounds like, it takes one IP address and translates it into another. There are lots of reasons why you would want to do this. They range from security safeguards to preserving the limited amounts of available IPv4 space. We'll discuss the implications of NAT and the IPv4 address space later in this lesson. But for now, let's just focus on how NAT itself works and how it can provide additional security measures to a network. At its most basic level, NAT is a technology that allows a gateway, usually a router or firewall, to rewrite the source IP of an outgoing IP datagram while retaining the original IP in order to rewrite it into the response. To explain this better, let's look at a simple NAT example. Let's say we have two networks. Network A consists of the 10.1.1.0/24 address space and network B consists of the 192.168.1.0/24 address space. Sitting between these networks is a router that has an interface on network A with an IP of 10.1.1.1 and an interface on network B of 192.168.1.1. Now, let's put two computers on these networks. Computer 1 is on network A and has an IP of 10.1.1.100. And computer 2 is on network B and has an IP of 192.168.1.100. Computer 1 wants to communicate with a web server on computer 2. So it crafts the appropriate packet at all layers and sends this to its primary gateway, the router sitting between the two networks. So far, this is a lot like many of our earlier examples, but in this instance, the router is configured to perform NAT for any outbound packets. Normally, a router will inspect the contents of an IP datagram, decrement the TTL by 1, re-calculate the checksum, and forward the rest of the data at the network layer without touching it. But with NAT, the router will also rewrite the source IP address, which in this instance, becomes the router's IP on network B or 192.168.1.1. When the datagram gets to computer 2, it'll look like it originated from the router, not from computer 1. Now, computer 2 crafts its response and sends it back to the router. The router, knowing that this traffic is actually intended for computer 1, rewrites the destination IP field before forwarding it along. What NAT is doing in this example, is hiding the IP of computer 1 from computer 2. This is known as IP masquerading. IP masquerading is an important security concept. The most basic concept at play here is that no one can establish a connection to your computer if they don't know what IP address it has. By using NAT in the way we've just described, we could actually have hundreds of computers on network A, all of their IPs being translated by the router to its own. To the outside world, the entire address space of network A is protected and invisible. This is known as one-to-many NAT, and you'll see it in use on lots of LANs today.

欢迎回来，准备好潜水了吗？ 因此，与 DNS 和 DHCP 等协议不同，网络地址转换或 NAT 是一种技术，而不是定义的标准。 这意味着我们将在本课中讨论的一些内容可能 比我们的其他一些主题更高。 不同的操作系统和不同的网络硬件供应商已经以 不同的方式实施了 NAT 的细节，但其完成的概念是相当不变的。 网络地址转换几乎完成听起来像， 它需要一个 IP 地址并将其转换为另一个 IP 地址。 有很多理由为什么你想这样做。 它们的范围从安全保障到保留有限数量 的 IPv4 可用空间。 我们将在 本课后面讨论 NAT 和 IPv4 地址空间的含义。 但是现在，让我们专注于 NAT 本身的工作原理 以及它如何为网络提供额外的安全措施。 在最基本的级别上，NAT 是一种技术，允许网关（ 通常是路由器或防火墙）重写传出 IP 数据报的源 IP， 同时保留原始 IP，以便将其重写到响应中。 为了更好地解释这一点，让我们看一个简单的 NAT 示例。 假设我们有两个网络。 网络 A 由 10.1.1.0/24 地址空间组成， 网络 B 由 192.168.1.0/24 地址空间组成。 位于 这些网络之间的路由器是 网络 A 上的接口，IP 为 10.1.1.1 ，网络 B 的接口为 192.168.1.1。 现在，让我们在这些网络上放置两台计算机。 计算机 1 位于网络 A 上，IP 为 10.1.1.100。 计算机 2 位于网络 B 上，并且 具有 192.168.1.100 的 IP。 计算机 1 希望与计算机 2 上的 Web 服务器进行通信。 因此，它在所有层设计合适的数据包，并 将其发送到其主网关，即位于两个网络之间的路由器。 到目前为 止，这与我们之前的许多示例非常相似，但在这种情况下， 路由器被配置为对任何出站数据包执行 NAT。 通常情况下，路由器会检查 IP 数据报的内容，将 TTL 递减 1，重新计算校验和，然后 转发网络层的其余数据而不触及它。 但是，使用 NAT 时，路由器还会重写源 IP 地址， 在这种情况下，源 IP 地址将成为网络 B 或 192.168.1.1 上路由器的 IP。 当数据报到达计算机 2 时， 它看起来像是源自路由器，而不是来自计算机 1。现在，计算机 2 制作其响应并将其发送回路由器。 路由器知道此通信实际上用于 计算机 1，因此在转发目标 IP 字段之前重写目标 IP 字段。 NAT 在此示例中所做的 是隐藏计算机 1 的 IP 从计算机 2。 这就是所谓的 IP 伪装。 IP 伪装是一个重要的安全概念。 这里最基本的概念是，没有人可以建立与 您的计算机的连接，如果他们不知道它有什么 IP 地址。 通过按照我们刚才描述的方式使用 NAT， 我们实际上可以在网络 A 上拥有数百台计算机，它 们的所有 IP 都被路由器转换为自己的 IP。 对于外部世界来说，网络 A 的整个地址空间是受到保护和 不可见的。 这被称为一对多 NAT， 您可以看到它今天在许多 LAN 上使用。